@model ProductoViewModel
@{
  ViewData["Title"] = "Detalle de Producto";
  @* var idSolicitado = ViewContext.RouteData.Values["id"]?.ToString(); *@
  var idSolicitado = @Context.Request.Path.ToString().Split("/").Last();
  var tieneProducto = Model != null;
  var imagenUrl = (tieneProducto && !string.IsNullOrWhiteSpace(Model.UrlImagen))
  ? Model.UrlImagen
  : Url.Content("~/img/producto-sin-imagen.png"); // poné un placeholder en wwwroot/img
}

<div class="container py-4">
  @if (tieneProducto)
  {
    <div class="d-flex align-items-center justify-content-between mb-3">
      <h1 class="h3 m-0">Producto #@Model.IdProducto</h1>
      <div class="btn-group">
        <a class="btn btn-outline-secondary" href="javascript:history.back()">← Volver</a>
        <a class="btn btn-outline-warning" asp-controller="Productos" asp-action="Modificar"
          asp-route-id="@Model.IdProducto">Editar</a>
        <a class="btn btn-outline-danger" asp-controller="Productos" asp-action="Eliminar"
          asp-route-id="@Model.IdProducto">Eliminar</a>
        <button type="button" class="btn btn-outline-secondary" id="copyLinkBtn" title="Copiar enlace">Copiar
          link</button>
      </div>
    </div>

    <div class="row g-4">
      <div class="col-12 col-md-5">
        <div class="card shadow-sm">
          <div class="ratio ratio-1x1">
            <img src="@imagenUrl" alt="Imagen del producto" class="card-img-top object-fit-contain p-3" />
          </div>
        </div>
      </div>

      <div class="col-12 col-md-7">
        <div class="card shadow-sm">
          <div class="card-body">
            <span class="badge text-bg-secondary mb-2">ID: @Model.IdProducto</span>
            <h2 class="card-title h4">@Model.Descripcion</h2>

            <div class="my-3">
              <span class="fw-semibold">Precio: </span>
              <span class="display-6">@Model.Precio.ToString("C")</span>
            </div>

            @* Si querés mostrar la URL de la imagen como link *@
            @if (!string.IsNullOrWhiteSpace(Model.UrlImagen))
            {
              <div class="mt-3">
                <a href="@Model.UrlImagen" target="_blank" rel="noopener" class="link-primary">Ver imagen en nueva pestaña</a>
              </div>
            }

            <div class="mt-4 d-flex gap-2">
              <a class="btn btn-warning" asp-controller="Productos" asp-action="Modificar"
                asp-route-id="@Model.IdProducto">Editar producto</a>
              <a class="btn btn-outline-secondary" asp-controller="Productos" asp-action="Index">Ir al listado</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  }
  else
  {
    <div class="alert alert-warning d-flex align-items-center" role="alert">
      <i class="bi bi-exclamation-triangle me-2"></i>
      <div>No se encontró producto con el id <strong>@idSolicitado</strong>.</div>
    </div>
    <a class="btn btn-secondary" href="javascript:history.back()">← Volver</a>
    <a class="btn btn-outline-primary ms-2" asp-controller="Productos" asp-action="Index">Ir al listado</a>
  }
</div>

@section Scripts {
  <script>
    (function () {
      const btn = document.getElementById('copyLinkBtn');
      if (btn) {
        btn.addEventListener('click', async function () {
          try {
            await navigator.clipboard.writeText(window.location.href);
            btn.textContent = '¡Link copiado!';
            setTimeout(() => btn.textContent = 'Copiar link', 1400);
          } catch {
            alert('No se pudo copiar el link.');
          }
        });
      }
    })();
  </script>
}