@model PresupuestoViewModel
@{
  string titulo;
}

<div class="container py-4">

  @if (Model != null)
  {
    <div class="d-flex align-items-center justify-content-between mb-4">
      <h1 class="h4 m-0">@Model.NombreDestinatario </h1>
      <a class="btn btn-secondary" href="javascript:history.back()">← Volver</a>
      
    </div>
    <h2 class="d-flex align-items-center justify-content-between mb-4 text h3">@Model.FechaCreacion.ToString("D").ToUpper()</h2>

    <div class="card shadow-sm mb-3">
      <div class="card-body">
        <div class="d-flex flex-wrap align-items-baseline gap-2">
          <span class="fw-semibold">Monto sin IVA:</span>
          <span class="h5 m-0">@Model.Monto.ToString("C")</span>

          <span class="mx-2 text-muted">|</span>

          <span class="fw-semibold">con IVA:</span>
          <span class="h5 m-0">@Model.MontoIva.ToString("C")</span>
        </div>

      </div>


    </div>

    <div class="card shadow-sm">
      <div class="card-body">
        <h2 class="h6 text-uppercase text-muted mb-3">Detalles</h2>

        <ol class="list-group list-group-numbered">
          @foreach (PresupuestoDetalle p in Model.Detalles)
          {
            double precioFinal = p.Producto.Precio * p.Cantidad;
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <span>@p.Producto.Descripcion x @p.Cantidad.ToString("N0") <a asp-controller="Productos" asp-action="Detalle" asp-route-id="@p.Producto.IdProducto">Ver mas</a></span>
              <span>
                <span class="badge bg-primary rounded-pill">
                  @precioFinal.ToString("C")
                </span >
                <form 
                  asp-controller="Presupuestos"   
                  asp-action="EliminarProducto" 
                  asp-route-IdProducto="@p.Producto.IdProducto" 
                  asp-route-IdPresupuesto="@Model.IdPresupuesto" 
                  class="badge"
                  method="post">
                  <input type="submit" class="bg-danger rounded-pill p-1" value="Eliminar">
                  
                </form>
              </span>

            </li>
          }
        </ol>
      </div>
    </div>
    <div class="d-flex gap-2 my-3">
      <a class="btn btn-secondary" href="javascript:history.back()">← Volver</a>

      <a class="btn btn-danger" asp-controller="Presupuestos" asp-action="Eliminar" asp-route-id="@Model.IdPresupuesto">
        Eliminar Presupuesto
      </a>

      <a class="btn btn-primary" asp-controller="Presupuestos" asp-action="AgregarProducto" asp-route-id="@Model.IdPresupuesto">
        Agregar Producto
      </a>

      <button type="button" class="btn btn-outline-secondary" id="btnCopyUrl">
        Copiar link
      </button>
    </div>
    titulo = $"Presupuesto {Model.IdPresupuesto}";
  }
  else
  {
    <div class="alert alert-warning" role="alert">
      No se encontró presupuesto con el id @Context.Request.Path.ToString().Split("/").Last()
    </div>
    titulo = "Presupuesto no encontrado";
  }

</div>

@{
  ViewData["title"] = titulo;

}
@section Scripts {
  <script>
    const btn = document.getElementById('btnCopyUrl');
    if (btn) {
      btn.addEventListener('click', async () => {
        await navigator.clipboard.writeText(window.location.href);
        btn.textContent = "¡Link copiado!";
        setTimeout(() => btn.textContent = "Copiar link", 1600);
      });
    }
  </script>
}